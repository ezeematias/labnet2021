USE [master]
GO
IF EXISTS (SELECT * FROM sys.databases d WHERE d.[name]='TP3_SQL')
BEGIN
	ALTER DATABASE [TP3_SQL] SET  SINGLE_USER WITH ROLLBACK IMMEDIATE
END
GO
USE [master]
GO
IF EXISTS (SELECT * FROM sys.databases d WHERE d.[name]='TP3_SQL')
BEGIN
	DROP DATABASE [TP3_SQL]
END
GO
CREATE DATABASE TP3_SQL
GO
USE TP3_SQL
GO
CREATE SCHEMA TP3 
GO
-- Tablas
CREATE TABLE TP3.PERSON 
			(ID_PERSON INT IDENTITY (1000,1) PRIMARY KEY
			,ID_COMPANY INT
			,DNI INT NOT NULL
			,FIRST_NAME VARCHAR(50) NOT NULL
			,LAST_NAME VARCHAR(50) NOT NULL
			,TELEPHONE VARCHAR(20) NOT NULL
			,DATE_BIRTH DATE NOT NULL);

CREATE TABLE TP3.ROLE
			(ID_ROLE INT IDENTITY PRIMARY KEY
			,DESCRIPTION VARCHAR(60));

CREATE TABLE TP3.COURSES 
			(ID_COURSES INT IDENTITY (5000,1) PRIMARY KEY
			,ID_PERSON INT NOT NULL
			,DURATION INT NOT NULL
			,TITLE_NAME VARCHAR(50) NOT NULL
			,START_DATE DATE NOT NULL
			,FINISH_DATE DATE NOT NULL);			

CREATE TABLE TP3.COMPANY 
			(ID_COMPANY INT IDENTITY PRIMARY KEY
			,CUIT VARCHAR(13) NOT NULL
			,NAME VARCHAR(50) NOT NULL
			,TELEPHONE VARCHAR(20) NOT NULL
			,ADDRESS VARCHAR(100) NOT NULL);

CREATE TABLE TP3.ROLE_PERSON
			(ID_ROLE_PERSON INT IDENTITY
			,ID_ROLE INT NOT NULL
			,ID_PERSON INT NOT NULL			
			CONSTRAINT PER_ROL
			PRIMARY KEY (ID_ROLE_PERSON, ID_ROLE,ID_PERSON));

CREATE TABLE TP3.QUALIFICATION
			(ID_QUALIFICATION INT IDENTITY
			,ID_COURSES INT NOT NULL
			,ID_PERSON INT NOT NULL
			,SCORE INT NOT NULL
			CONSTRAINT PER_COU
			PRIMARY KEY (ID_QUALIFICATION,ID_PERSON,ID_COURSES));

-- Relaciones
ALTER TABLE TP3.ROLE_PERSON
			ADD CONSTRAINT PER_CAT			
			FOREIGN KEY (ID_PERSON) 
			REFERENCES TP3.PERSON,
			FOREIGN KEY (ID_ROLE) 
			REFERENCES TP3.ROLE;

ALTER TABLE TP3.QUALIFICATION
			ADD CONSTRAINT COU_PER
			FOREIGN KEY (ID_COURSES)
			REFERENCES TP3.COURSES,
			FOREIGN KEY (ID_PERSON) 
			REFERENCES TP3.PERSON

ALTER TABLE TP3.PERSON
			ADD CONSTRAINT PER_COM
			FOREIGN KEY (ID_COMPANY) 
			REFERENCES TP3.COMPANY;

ALTER TABLE TP3.QUALIFICATION
			ADD CONSTRAINT IDC_IDP
			UNIQUE (ID_COURSES,ID_PERSON);

ALTER TABLE TP3.COURSES
			ADD CONSTRAINT IDP_IDC
			UNIQUE (ID_PERSON,ID_COURSES);

-- Role
INSERT INTO TP3.ROLE (DESCRIPTION)
VALUES ('Alumno');

INSERT INTO TP3.ROLE (DESCRIPTION)
VALUES ('Profesor');

-- Company
INSERT INTO TP3.COMPANY (CUIT,NAME,TELEPHONE,ADDRESS) 
VALUES ('30-87963258-2','Los pedritos SRL','4245-4872','Falsa 123');

INSERT INTO TP3.COMPANY (CUIT,NAME,TELEPHONE,ADDRESS) 
VALUES ('30-25878922-7','Monjes SA','3015-7288','Sarmiento 1042');

INSERT INTO TP3.COMPANY (CUIT,NAME,TELEPHONE,ADDRESS) 
VALUES ('30-75395101-5','Salchichas Saladas SA','4789-3214','Av Corrientes 911');

-- Persons
INSERT INTO TP3.PERSON (ID_COMPANY, DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (1,35019857,'Ezequiel', 'Unía','011-6878-1359','1990-07-30');

INSERT INTO TP3.PERSON (ID_COMPANY, DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (1,38147852,'Matías', 'Gomez','011-5547-1500','1993-02-22');

INSERT INTO TP3.PERSON (ID_COMPANY, DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (2,33147852,'Gladys', 'Ramirez','011-2044-0044','1989-05-01');

INSERT INTO TP3.PERSON (ID_COMPANY, DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (2,40151102,'Jorge', 'Garcia','011-4777-1577','1997-02-04');

INSERT INTO TP3.PERSON (ID_COMPANY, DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (NULL,43187459,'Pedro', 'Suarez','011-5588-8815','2000-03-10');

INSERT INTO TP3.PERSON (ID_COMPANY, DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (NULL,30784519,'Marta', 'Sanchez','011-2488-2355','1985-08-07');

INSERT INTO TP3.PERSON (ID_COMPANY, DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (3,30012785,'Rodolfo', 'Sacachispas','011-3484-7832','1985-02-21');

INSERT INTO TP3.PERSON (ID_COMPANY, DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (3,32387410,'Violeta', 'Perez','011-7458-3344','1989-05-21');

-- Roll Person
INSERT INTO TP3.ROLE_PERSON (ID_ROLE, ID_PERSON)
VALUES		(1,1000);

INSERT INTO TP3.ROLE_PERSON (ID_ROLE, ID_PERSON)
VALUES		(1,1001);

INSERT INTO TP3.ROLE_PERSON (ID_ROLE, ID_PERSON)
VALUES		(2,1001);

INSERT INTO TP3.ROLE_PERSON (ID_ROLE, ID_PERSON)
VALUES		(1,1002);

INSERT INTO TP3.ROLE_PERSON (ID_ROLE, ID_PERSON)
VALUES		(1,1003);

INSERT INTO TP3.ROLE_PERSON (ID_ROLE, ID_PERSON)
VALUES		(1,1004);

INSERT INTO TP3.ROLE_PERSON (ID_ROLE, ID_PERSON)
VALUES		(1,1005);

INSERT INTO TP3.ROLE_PERSON (ID_ROLE, ID_PERSON)
VALUES		(2,1006);

-- Courses
INSERT INTO TP3.COURSES (ID_PERSON, DURATION, TITLE_NAME, START_DATE, FINISH_DATE) 
VALUES (1006,35,'Tecnicatura en Programación','2014-02-02','2016-10-04');

INSERT INTO TP3.COURSES (ID_PERSON, DURATION, TITLE_NAME, START_DATE, FINISH_DATE) 
VALUES (1007,50,'Analista funcional','2015-02-02','2016-02-05');

INSERT INTO TP3.COURSES (ID_PERSON, DURATION, TITLE_NAME, START_DATE, FINISH_DATE) 
VALUES (1001,25,'Base de Datos','2016-02-02','2016-12-03');

INSERT INTO TP3.COURSES (ID_PERSON, DURATION, TITLE_NAME, START_DATE, FINISH_DATE) 
VALUES (1006,45,'Mikrotik','2015-01-10','2016-01-12');

INSERT INTO TP3.COURSES (ID_PERSON, DURATION, TITLE_NAME, START_DATE, FINISH_DATE) 
VALUES (1007,75,'Redes Inform{aticas','2015-10-04','2017-03-07');

INSERT INTO TP3.COURSES (ID_PERSON, DURATION, TITLE_NAME, START_DATE, FINISH_DATE) 
VALUES (1001,50,'Reparación de celulares','2017-9-01','2017-11-07');


-- Qualification
INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5000,1000,9);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5000,1001,8);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5000,1002,9);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5000,1003,2);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5000,1004,3);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5000,1005,7);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5001,1000,7);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5001,1001,1);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5001,1002,8);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5001,1003,9);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5001,1004,3);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5001,1005,10);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5002,1002,2);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5002,1003,7);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5002,1004,7);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5002,1005,8);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5003,1001,6);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5003,1002,2);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5003,1003,6);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5003,1004,1);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5003,1005,8);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5003,1006,8);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5004,1001,7);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5004,1002,9);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5004,1003,2);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5004,1004,7);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5004,1005,8);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5005,1004,10);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5005,1003,5);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5005,1000,10);

INSERT INTO TP3.QUALIFICATION (ID_COURSES,ID_PERSON,SCORE)
VALUES		(5005,1005,5);