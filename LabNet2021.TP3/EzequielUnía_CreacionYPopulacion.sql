USE [master]
GO
IF EXISTS (SELECT * FROM sys.databases d WHERE d.[name]='TP3_SQL')
BEGIN
	ALTER DATABASE [TP3_SQL] SET  SINGLE_USER WITH ROLLBACK IMMEDIATE
END
GO
USE [master]
GO
IF EXISTS (SELECT * FROM sys.databases d WHERE d.[name]='TP3_SQL')
BEGIN
	DROP DATABASE [TP3_SQL]
END
GO
CREATE DATABASE TP3_SQL
GO
USE TP3_SQL
GO
CREATE SCHEMA TP3 
GO
-- Tablas
CREATE TABLE TP3.PERSON 
			(ID INT IDENTITY (1000,1) PRIMARY KEY
			,DNI INT
			,FIRST_NAME VARCHAR(50) NOT NULL
			,LAST_NAME VARCHAR(50) NOT NULL
			,TELEPHONE VARCHAR(20) NOT NULL
			,DATE_BIRTH DATE NOT NULL);

CREATE TABLE TP3.ROLL
			(ID INT IDENTITY PRIMARY KEY
			,DESCRIPTION VARCHAR(60));

CREATE TABLE TP3.COURSES 
			(ID INT IDENTITY (5000,1) PRIMARY KEY
			,PERSON_ID INT NOT NULL
			,DURATION INT NOT NULL
			,TITLE_NAME VARCHAR(50) NOT NULL
			,START_DATE DATE NOT NULL
			,FINISH_DATE DATE NOT NULL);

CREATE TABLE TP3.COMPANY 
			(ID INT IDENTITY PRIMARY KEY
			,CUIT VARCHAR(13) NOT NULL
			,NAME VARCHAR(50) NOT NULL
			,TELEPHONE VARCHAR(20) NOT NULL
			,ADDRESS VARCHAR(100) NOT NULL);

CREATE TABLE TP3.ROLL_PERSON
			(ROLL_ID INT NOT NULL
			,PERSON_ID INT NOT NULL
			,COMPANY_ID INT
			CONSTRAINT PER_ROL
			PRIMARY KEY (ROLL_ID,PERSON_ID));

CREATE TABLE TP3.QUALIFICATION
			(COURSES_ID INT NOT NULL
			,PERSON_ID INT NOT NULL
			,SCORE INT NOT NULL
			CONSTRAINT PER_COU
			PRIMARY KEY (COURSES_ID,PERSON_ID));

-- Relaciones
ALTER TABLE TP3.ROLL_PERSON
			ADD CONSTRAINT PER_CAT			
			FOREIGN KEY (PERSON_ID) 
			REFERENCES TP3.PERSON,
			FOREIGN KEY (ROLL_ID) 
			REFERENCES TP3.ROLL,
			FOREIGN KEY (COMPANY_ID) 
			REFERENCES TP3.COMPANY;

ALTER TABLE TP3.QUALIFICATION
			ADD CONSTRAINT COU_PER
			FOREIGN KEY (COURSES_ID)
			REFERENCES TP3.COURSES,
			FOREIGN KEY (PERSON_ID) 
			REFERENCES TP3.PERSON;


-- Rolls
INSERT INTO TP3.ROLL (DESCRIPTION)
VALUES ('Alumno');

INSERT INTO TP3.ROLL (DESCRIPTION)
VALUES ('Profesor');

-- Company
INSERT INTO TP3.COMPANY (CUIT,NAME,TELEPHONE,ADDRESS) 
VALUES ('30-87963258-2','Los pedritos SRL','4245-4872','Falsa 123');

INSERT INTO TP3.COMPANY (CUIT,NAME,TELEPHONE,ADDRESS) 
VALUES ('30-25878922-7','Monjes SA','3015-7288','Sarmiento 1042');

INSERT INTO TP3.COMPANY (CUIT,NAME,TELEPHONE,ADDRESS) 
VALUES ('30-75395101-5','Salchichas Saladas SA','4789-3214','Av Corrientes 911');

-- Persons
INSERT INTO TP3.PERSON (DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (35019857,'Ezequiel', 'Unía','011-6878-1359','1990-07-30');

INSERT INTO TP3.PERSON (DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (38147852,'Matías', 'Gomez','011-5547-1500','1993-02-22');

INSERT INTO TP3.PERSON (DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (33147852,'Gladys', 'Ramirez','011-2044-0044','1989-05-01');

INSERT INTO TP3.PERSON (DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (40151102,'Jorge', 'Garcia','011-4777-1577','1997-02-04');

INSERT INTO TP3.PERSON (DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (43187459,'Pedro', 'Suarez','011-5588-8815','2000-03-10');

INSERT INTO TP3.PERSON (DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (30784519,'Marta', 'Sanchez','011-2488-2355','1985-08-07');

INSERT INTO TP3.PERSON (DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (30012785,'Rodolfo', 'Sacachispas','011-3484-7832','1985-02-21');

INSERT INTO TP3.PERSON (DNI, FIRST_NAME, LAST_NAME, TELEPHONE, DATE_BIRTH) 
VALUES (32387410,'Violeta', 'Perez','011-7458-3344','1989-05-21');

-- Courses
INSERT INTO TP3.COURSES (PERSON_ID, DURATION, TITLE_NAME, START_DATE, FINISH_DATE) 
VALUES (1006,35,'Tecnicatura en Programación','2014-02-02','2016-10-04');

INSERT INTO TP3.COURSES (PERSON_ID, DURATION, TITLE_NAME, START_DATE, FINISH_DATE) 
VALUES (1007,50,'Analista funcional','2015-02-02','2016-02-05');

INSERT INTO TP3.COURSES (PERSON_ID, DURATION, TITLE_NAME, START_DATE, FINISH_DATE) 
VALUES (1001,25,'Base de Datos','2016-02-02','2016-12-03');

INSERT INTO TP3.COURSES (PERSON_ID, DURATION, TITLE_NAME, START_DATE, FINISH_DATE) 
VALUES (1006,45,'Mikrotik','2015-01-10','2016-01-12');

INSERT INTO TP3.COURSES (PERSON_ID, DURATION, TITLE_NAME, START_DATE, FINISH_DATE) 
VALUES (1007,75,'Redes Inform{aticas','2015-10-04','2017-03-07');

INSERT INTO TP3.COURSES (PERSON_ID, DURATION, TITLE_NAME, START_DATE, FINISH_DATE) 
VALUES (1001,50,'Reparación de celulares','2017-9-01','2017-11-07');

-- Roll Person
INSERT INTO TP3.ROLL_PERSON (ROLL_ID, PERSON_ID, COMPANY_ID)
VALUES (1,1000,1);

INSERT INTO TP3.ROLL_PERSON (ROLL_ID, PERSON_ID, COMPANY_ID)
VALUES (1,1001,2);

INSERT INTO TP3.ROLL_PERSON (ROLL_ID, PERSON_ID, COMPANY_ID)
VALUES (2,1001,2);

INSERT INTO TP3.ROLL_PERSON (ROLL_ID, PERSON_ID, COMPANY_ID)
VALUES (1,1002,3);

INSERT INTO TP3.ROLL_PERSON (ROLL_ID, PERSON_ID, COMPANY_ID)
VALUES (1,1003,NULL);

INSERT INTO TP3.ROLL_PERSON (ROLL_ID, PERSON_ID, COMPANY_ID)
VALUES (1,1004,3);

INSERT INTO TP3.ROLL_PERSON (ROLL_ID, PERSON_ID, COMPANY_ID)
VALUES (1,1005,2);

INSERT INTO TP3.ROLL_PERSON (ROLL_ID, PERSON_ID, COMPANY_ID)
VALUES (2,1006,1);

-- Qualification
INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5000,1000,9);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5000,1001,8);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5000,1002,9);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5000,1003,2);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5000,1004,3);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5000,1005,7);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5001,1000,7);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5001,1001,1);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5001,1002,8);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5001,1003,9);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5001,1004,3);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5001,1005,10);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5002,1002,2);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5002,1003,7);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5002,1004,7);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5002,1005,8);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5003,1001,6);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5003,1002,2);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5003,1003,6);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5003,1004,1);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5003,1005,8);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5003,1006,8);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5004,1001,7);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5004,1002,9);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5004,1003,2);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5004,1004,7);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5004,1005,8);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5005,1004,10);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5005,1003,5);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5005,1000,10);

INSERT INTO TP3.QUALIFICATION (COURSES_ID,PERSON_ID,SCORE)
VALUES (5005,1005,5);
